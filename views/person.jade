extends layout

block content
  .well.content-well
    if (typeof(user) != 'undefined' && user._id.toString() == person._id.toString())
      .pull-right
        a.btn(data-action="enable-profile-editor") EDIT!
        if (!person.profiles || !person.profiles.lastfm || !person.profiles.lastfm.username)
          a.btn.btn-mini(href="/auth/lastfm") add last.fm &raquo;

      form#profile-editor(action="/#{user.slug}", method="post", style="display:none;")
        h4 Bio (markdown supported)
        textarea.input-block-level(name="bio", rows="5") #{person.bio}

        h4 Email Address (used for avatars, using <a href="http://en.gravatar.com/">gravatar</a>)
        input.input-block-level(name="email", value="#{((person.email) ? person.email : '')}")

        button.btn.btn-primary(type="submit") Make Changes &raquo;

    img.avatar-large.pull-left(src="#{person.avatar.url}")
    h1 #{person.username} 
      if (person.profiles && person.profiles.lastfm && person.profiles.lastfm.username)
        a(href="http://last.fm/user/#{person.profiles.lastfm.username}")
          img(src="/img/last.fm.ico", title="#{person.profiles.lastfm.username}")

    ul.nav.nav-tabs
      li.active
        a(href="#profile", data-toggle="tab") Profile
      li
        a(href="#playlists", data-toggle="tab") Playlists
      li
        a(href="#plays", data-toggle="tab") Plays

    .tab-content
      .tab-pane.active#profile
        .bio
          | !{marked(person.bio)}

      .tab-pane#playlists
        h3 Public Playlists 
          ul.nav.nav-list
            for playlist in playlists
              li
                h4
                  a(href="/#{person.slug}/#{playlist.slug}") #{playlist.name}
                  if (playlist.public)
                    |  
                    span.badge.badge-default
                      i.icon-globe(title="public")
                      |  public
                p #{playlist.description}

      .tab-pane#plays
        h3 Recent Plays (<a href="/#{person.slug}/plays">view all &raquo;</a>)
        table.table.tablesorter
          thead
            tr
              th Who
              th When
              th Artist
              th Title
              th Controls
          tbody
            for play in plays
              include partials/play-row
