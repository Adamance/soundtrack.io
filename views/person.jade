extends layout

block content
  .well.content-well
    if (typeof(user) != 'undefined' && user._id.toString() == person._id.toString())
      .pull-right
        a.btn(data-action="enable-profile-editor") EDIT!
        if (!person.profiles || !person.profiles.lastfm || !person.profiles.lastfm.username)
          a.btn.btn-mini(href="/auth/lastfm") add last.fm &raquo;

      form#profile-editor(action="/#{user.slug}", method="post", style="display:none;")
        h4 Bio (markdown supported)
        textarea.input-block-level(name="bio", rows="5") #{person.bio}

        h4 Email Address (used for avatars, using <a href="http://en.gravatar.com/">gravatar</a>)
        input.input-block-level(name="email", value="#{((person.email) ? person.email : '')}")

        button.btn.btn-primary(type="submit") Make Changes &raquo;

    img.avatar-large.pull-left(src="#{person.avatar.url}")
    h1 #{person.username} 
      if (person.profiles && person.profiles.lastfm && person.profiles.lastfm.username)
        a(href="http://last.fm/user/#{person.profiles.lastfm.username}")
          img(src="/img/last.fm.ico", title="#{person.profiles.lastfm.username}")

    ul.nav.nav-tabs
      li.active
        a(href="#profile", data-toggle="tab") Profile
      li
        a(href="#playlists", data-toggle="tab") Playlists
      li
        a(href="#plays", data-toggle="tab") Plays

    .tab-content
      .tab-pane.active#profile
        .bio
          | !{marked(person.bio)}

      .tab-pane#playlists
        h3
          if (user && user._id.toString() === person._id.toString())
            a.pull-right.btn.btn-default(href="/#{user.slug}/playlists/new") Add New &raquo;
          | Playlists
        table.table.tablesorter
          thead
            tr
              if (user && user._id.toString() === person._id.toString())
                th
                  i.icon-globe
              th Name
              if (user && user._id.toString() === person._id.toString())
                th Status
              th Tracks
              if (user && user._id.toString() === person._id.toString())
                th Controls
          tbody
            for playlist in playlists
              tr
                if (user && user._id.toString() === person._id.toString())
                  td
                    input(type="checkbox", data-action="toggle-playlist-visibility", data-playlist-id="#{playlist._id}", checked=(playlist.public ? "checked" : undefined))
                td
                  a(href="/#{person.slug}/#{playlist.slug}") #{playlist.name}
                if (user && user._id.toString() === person._id.toString())
                  td
                    span.badge.badge-default
                      if (playlist.public)
                        i.icon-globe(title="public")
                        |  public
                      else
                        i.icon-eye-close(title="private")
                        |  private
                td #{playlist._tracks.length}
                if (user && user._id.toString() === person._id.toString())
                  td
                    a(href="#", data-action="delete-playlist", data-playlist-id="#{playlist._id}")
                      i.icon-remove.icon-white
                
      .tab-pane#plays
        h3 Recent Plays (<a href="/#{person.slug}/plays">view all &raquo;</a>)
        table.table.tablesorter
          thead
            tr
              th Who
              th When
              th Artist
              th Title
              th Controls
          tbody
            for play in plays
              include partials/play-row
